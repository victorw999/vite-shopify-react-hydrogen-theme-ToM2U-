import{f as i}from"./utils.yhNUuzph.min.js";class a extends window.HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.form.querySelector('[name="id"]').disabled=!1,this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.cart=document.querySelector("cart-drawer"),this.submitButton=this.querySelector('[type="submit"]'),document.querySelector("cart-drawer")&&this.submitButton.setAttribute("aria-haspopup","dialog")}onSubmitHandler(e){if(e.preventDefault(),this.submitButton.getAttribute("aria-disabled")===!0)return;this.handleErrorMessage(),this.submitButton.setAttribute("aria-disabled",!0),this.submitButton.classList.add("loading");const r=i("javascript");r.headers["X-Requested-With"]="XMLHttpRequest",delete r.headers["Content-Type"];const s=new window.FormData(this.form);this.cart&&(s.append("sections",this.cart.getSectionsToRender().map(t=>t.id)),s.append("sections_url",window.location.pathname),this.cart.setActiveElement(document.activeElement)),r.body=s,fetch(`${window.routes.cart_add_url}`,r).then(t=>t.json()).then(t=>{if(t.status){this.handleErrorMessage(t.description),this.submitButton.setAttribute("aria-disabled",!0),this.error=!0;return}if(!this.cart){window.location=window.routes.cart_url;return}this.error=!1,this.cart.renderContents(t)}).catch(t=>{console.error(t)}).finally(()=>{this.submitButton.classList.remove("loading"),this.cart&&this.cart.classList.contains("is-empty")&&this.cart.classList.remove("is-empty"),this.error||this.submitButton.removeAttribute("aria-disabled")})}handleErrorMessage(e=!1){this.errorMessage=this.errorMessage||this.querySelector("[data-error-message]"),this.errorMessage.toggleAttribute("hidden",!e),e&&(this.errorMessage.textContent=e)}}window.customElements.define("product-form",a);

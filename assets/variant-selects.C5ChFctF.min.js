class s extends window.HTMLElement{constructor(){super(),this.addEventListener("change",this.onVariantChange)}onVariantChange(){this.updateOptions(),this.updateMasterId(),this.toggleAddButton(!0,"",!1),this.removeErrorMessage(),this.currentVariant?(this.updateURL(),this.updateVariantInput(),this.renderProductInfo()):(this.toggleAddButton(!0,"",!0),this.setUnavailable())}updateOptions(){this.options=Array.from(this.querySelectorAll("select"),t=>t.value)}updateMasterId(){this.currentVariant=this.getVariantData().find(t=>!t.options.map((e,n)=>this.options[n]===e).includes(!1))}updateURL(){!this.currentVariant||this.dataset.updateUrl==="false"||window.history.replaceState({},"",`${this.dataset.url}?variant=${this.currentVariant.id}`)}updateVariantInput(){document.querySelectorAll(`#product-form-${this.dataset.section}, #product-form-installment-${this.dataset.section}`).forEach(e=>{const n=e.querySelector('input[name="id"]');n.value=this.currentVariant.id,n.dispatchEvent(new Event("change",{bubbles:!0}))})}removeErrorMessage(){const t=this.closest("section");if(!t)return;const e=t.querySelector("product-form");e&&e.handleErrorMessage()}renderProductInfo(){fetch(`${this.dataset.url}?variant=${this.currentVariant.id}&section_id=${this.dataset.originalSection?this.dataset.originalSection:this.dataset.section}`).then(t=>t.text()).then(t=>{const e=new window.DOMParser().parseFromString(t,"text/html"),n=document.getElementById(`price-${this.dataset.section}`),a=e.getElementById(`price-${this.dataset.originalSection?this.dataset.originalSection:this.dataset.section}`);a&&n&&(n.innerHTML=a.innerHTML);const i=document.getElementById(`price-${this.dataset.section}`);i&&i.classList.remove("invisible"),this.toggleAddButton(!this.currentVariant.available,window.variantStrings.soldOut)})}toggleAddButton(t=!0,e,n=!0){const a=document.getElementById(`product-form-${this.dataset.section}`);if(!a)return;const i=a.querySelector('[name="add"]'),r=a.querySelector('[name="add"] > span');i&&(t?(i.setAttribute("disabled","disabled"),e&&(r.textContent=e)):(i.removeAttribute("disabled"),r.textContent=window.variantStrings.addToCart))}setUnavailable(){const t=document.getElementById(`product-form-${this.dataset.section}`),e=t.querySelector('[name="add"]'),n=t.querySelector('[name="add"] > span'),a=document.getElementById(`price-${this.dataset.section}`);e&&(n.textContent=window.variantStrings.unavailable,a&&a.classList.add("invisible"))}getVariantData(){return this.variantData=this.variantData||JSON.parse(this.querySelector('[type="application/json"]').textContent),this.variantData}}window.customElements.define("variant-selects",s);export{s as default};
